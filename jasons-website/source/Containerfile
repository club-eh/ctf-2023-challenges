FROM golang:1.19-buster AS build

WORKDIR /web

COPY ./server/go.mod ./
COPY ./server/go.sum ./

RUN go mod download

COPY ./server ./

RUN go build -o main

FROM gcr.io/distroless/base-debian10

WORKDIR /web

COPY ./server/assets ./assets
COPY ./server/views ./views
COPY ./flag.txt /flag.txt
COPY --from=build /web/main ./main

ENV PORT=":8080"
ENV SECRET="_X1}?Tw:h2vQv-0r-+WQJqKF=wj])3FY"

ENTRYPOINT ["/web/main"]
